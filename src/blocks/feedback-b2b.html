<div class="PopupForm PopupForm--Feedback Feedback" id="feedback-form-vue">
  <div class="PopupForm__Screenlock"></div>
  <div class="PopupForm__Content" style="background-position: center; background-size: cover; background-repeat: no-repeat; background-image: url('./assets/images/feedback-bg.jpg')">
    <div class="PopupForm__ContentLeft">
      <img class="PopupForm__Logo" src="./assets/images/logo.svg" alt="logo">
      <div class="PopupForm__Country">Россия</div>
      <div class="PopupForm__Address">Москва, Новодмитровская 2, кор. 1<br>Савеловский Сити, башня Goodman</div>
      <div class="PopupForm__PhonesBlock">
        <img class="PopupForm__PhoneIcon" src="./assets/images/icons/gold-phone-icon.svg" alt="phone">
        <div class="PopupForm__Phones">
          <a class="PopupForm__Phone" href="#">+7 495 266-63-77</a>
          <a class="PopupForm__Phone" href="#">+7 800 100-19-70</a>
        </div>
      </div>
      <div class="PopupForm__MailContainer">
        <a class="PopupForm__MailLink" href="#">info@resort-holiday.com</a>
      </div>
    </div>
    <div class="PopupForm__ContentRight">
      <div class="PopupForm__Title">
        <div class="PopupForm__TitleText">Напишите нам</div>
        <button class="PopupForm__TitleClose">
          <img src="./assets/images/icons/close-icon.svg" alt="close">
        </button>
      </div>
      <form class="PopupForm__Form" @submit.prevent="sendToBackend">
        <input class="PopupForm__TextInput" type="text" v-model="name" required placeholder="*Ваше имя">
        <input class="PopupForm__TextInput" type="text" v-model="agency" required  placeholder="*Ваше агентство">
        <input class="PopupForm__TextInput" type="email" v-model="email" required placeholder="*Ваш email">
        <div class="PopupForm__CheckboxContainer">
          <input class="PopupForm__Checkbox" @click="wantTo = '27'" :checked="wantTo === '27'" type="checkbox">
          <label class="PopupForm__CheckboxLabel">Я хочу оставить отзыв</label>
        </div>
        <div class="PopupForm__CheckboxContainer">
          <input class="PopupForm__Checkbox" @click="wantTo = '28'" :checked="wantTo === '28'" type="checkbox">
          <label class="PopupForm__CheckboxLabel">Я хочу оставить благодарность</label>
        </div>
        <div class="PopupForm__CheckboxContainer">
          <input class="PopupForm__Checkbox" @click="wantTo = '29'" :checked="wantTo === '29'" type="checkbox">
          <label class="PopupForm__CheckboxLabel">Я хочу помочь вам стать лучше</label>
        </div>
        <div class="PopupForm__CheckboxContainer">
          <input class="PopupForm__Checkbox" @click="wantTo = '30'" :checked="wantTo === '30'" type="checkbox">
          <label class="PopupForm__CheckboxLabel">Я хочу задать вопрос, т.к. не нашла / нашел ответ на сайте</label>
        </div>
        <div class="PopupForm__Text">Все вопросы по заявкам вы можете отправить из Личного Кабинета агента через кнопку "Отправить сообщение"</div>
        <textarea class="PopupForm__Textarea" v-model="message" cols="30" required rows="5" placeholder="Введите текст сообщения"></textarea>
        <div class="PopupForm__FileUpload">
          <div class="PopupForm__FileUploadInner">
            <div class="PopupForm__FileUploadInfo">
              <div class="PopupForm__FileUploadInfoText PopupForm__FileUploadInfoText--Big--Big">Прикрепить файл</div>
              <div class="PopupForm__FileUploadInfoText PopupForm__FileUploadInfoText--Small--Small">(не более 5 Мб)</div>
            </div>
            <label class="PopupForm__FileUploadLabel">
              <input class="PopupForm__FileUploadInput" type="file" @change="addFile($event)"/>
              <svg class="PopupForm__FileUploadIcon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M6.84932 19.9999C5.11416 19.9999 3.379 19.3685 2.00913 18.0157C0.730594 16.753 0 15.0393 0 13.2355C0 11.4317 0.730594 9.71803 2.00913 8.45535L9.13242 1.4204C11.0502 -0.473628 14.2466 -0.473628 16.2557 1.4204C18.2648 3.31442 18.1735 6.47113 16.2557 8.45535L9.77169 14.859C8.49315 16.1216 6.48402 16.1216 5.20548 14.859C3.92694 13.5963 3.92694 11.6121 5.20548 10.3494L10.6849 4.93787C11.0502 4.57711 11.5982 4.57711 11.9635 4.93787C12.3288 5.29864 12.3288 5.83979 11.9635 6.20056L6.48402 11.6121C5.93607 12.1532 5.93607 12.9649 6.48402 13.5061C7.03196 14.0472 7.85388 14.0472 8.40183 13.5061L14.8858 7.10247C15.5251 6.47113 15.7991 5.7496 15.7991 4.84768C15.7991 4.03596 15.4338 3.22423 14.8858 2.59289C13.6073 1.33021 11.5982 1.33021 10.411 2.59289L3.28767 9.62784C2.37443 10.5298 1.82648 11.7924 1.82648 13.1453C1.82648 14.4982 2.37443 15.6707 3.28767 16.6628C5.20548 18.5568 8.40183 18.5568 10.411 16.6628L18.4475 8.72592C18.8128 8.36516 19.3607 8.36516 19.726 8.72592C20.0913 9.08669 20.0913 9.62784 19.726 9.9886L11.6895 17.9255C10.411 19.3685 8.6758 19.9999 6.84932 19.9999Z" fill="#285C2D"/>
              </svg>
            </label>
          </div>
        </div>
        <div class="PopupForm__CheckboxContainer">
          <input class="PopupForm__Checkbox" type="checkbox" v-model="agree">
          <label class="PopupForm__CheckboxLabel">Согласен с <a href="#"><u>Положением об обработке и защите персональных данных</u></a></label>
        </div>
        <button class="PopupForm__SubmitButton" type="submit">Отправить</button>
        <success-message v-if="showSuccess"></success-message>
      </form>
    </div>
  </div>
</div>
<script>
  new Vue({
    el: "#feedback-form-vue",

    data: function () {
      return {
        agree: false,
        name: "",
        email: "",
        agency: "",
        wantTo: "",
        message: "",
        showSuccess: false,
        file: null,
        fileExt: null,
      };
    },

    methods: {
      addFile(event) {
        const file = event.target.files[0];
        if (file.size >  5 * (1024*1024)) {
          return;
        }

        var reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload =  () => {
          this.file = reader.result;
          this.fileExt = event.target.value.split('.').pop();
        };
        reader.onerror = function (error) {
          console.log('Error on load file: ', error);
        };
      },

      sendToBackend() {
        if (!this.agree) return;
        if (!this.wantTo) return;
        
        const dataload = {
          "type":"write_to_us",
          "client_name": this.name,
          "agency": this.agency,
          "email": this.email,
          "want_to": this.wantTo,
          "file": this.file,
          "file_ext": this.fileExt,
          "message": this.message,
        };

        fetch(`https://dev.resort-holiday.com/api/forms/?type=write_to_us`, { 
          method: "POST", body: JSON.stringify(dataload) 
        }).then(response => {
          this.showSuccess = true;
          setTimeout(() => {
            this.showSuccess = false;
          }, 2000);
        }).catch(function (error) {
          console.log("Error to post Telegram form data", error);
        });
      },
    },
  });
</script>